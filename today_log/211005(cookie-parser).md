# 211005(cookie-parser)

## 오늘 한 일

- 항해99에서 받은 명세서에 따라서, 블로그를 만들고 있다.  (해결 한 것에 대해서 👌  표시)
    
    회원 가입 페이지
    
    - 회원가입 버튼을 클릭하기
    - 닉네임, 비밀번호, 비밀번호 확인을 입력하기
    - 닉네임은 `최소 3자 이상, 알파벳 대소문자(a~z, A~Z), 숫자(0~9)`로 구성하기
    - 비밀번호는 `최소 4자 이상이며, 닉네임과 같은 값이 포함된 경우 회원가입에 실패`로 만들기
    - 비밀번호 확인은 비밀번호와 정확하게 일치하기
    - 데이터베이스에 존재하는 닉네임을 입력한 채 회원가입 버튼을 누른 경우 "중복된 닉네임입니다." 라는 에러메세지를 프론트엔드에서 보여주기
    - 회원가입 버튼을 누르고 에러메세지가 발생하지 않는다면 `로그인 페이지`로 이동시키기
    
    회원 가입 페이지
    
    - 회원가입 버튼을 클릭하기**(211005)**👌
    - 닉네임, 비밀번호, 비밀번호 확인을 입력하기**(211005)**👌
    - 닉네임은 `최소 3자 이상, 알파벳 대소문자(a~z, A~Z), 숫자(0~9)`로 구성하기
    - 비밀번호는 `최소 4자 이상이며, 닉네임과 같은 값이 포함된 경우 회원가입에 실패`로 만들기
    - 비밀번호 확인은 비밀번호와 정확하게 일치하기**(211005)**👌
    - 데이터베이스에 존재하는 닉네임을 입력한 채 회원가입 버튼을 누른 경우 "중복된 닉네임입니다." 라는 에러메세지를 프론트엔드에서 보여주기**(211005)**👌
    - 회원가입 버튼을 누르고 에러메세지가 발생하지 않는다면 `로그인 페이지`로 이동시키기**(211005)**👌
    
    1. 로그인 페이지
        - 로그인, 회원가입 버튼을 만들기**(211005)**👌
        - 닉네임, 비밀번호 입력란 만들기**(211005)**👌
        - 로그인 버튼을 누른 경우 닉네임과 비밀번호가 데이터베이스에 등록됐는지 확인한 뒤, 하나라도 맞지 않는 정보가 있다면 "닉네임 또는 패스워드를 확인해주세요"라는 메세지를 프론트엔드에서 보여주기**(211005)**👌
        - 로그인 버튼을 눌러서 에러 메세지가 발생하지 않는다면 `전체 게시글 목록 조회 페이지`로 이동시키기**(211005)**👌
    2. 로그인 검사
        - `아래 페이지를 제외하고` 모두 로그인 한 경우만 볼 수 있도록 하기
            - 회원가입 페이지
            - 로그인 페이지
            - 게시글 목록 조회 페이지
            - 게시글 조회 페이지
        - 로그인을 하지 않거나 올바르지 않은 경로로 접속한 사용자가 로그인이 필요한 경로에 접속한 경우 "로그인이 필요합니다." 라는 메세지를 프론트엔드에서 띄워주고 `로그인 페이지`로 이동시키기
        - 로그인 한 사용자가 로그인 페이지 또는 회원가입 페이지에 접속한 경우 "이미 로그인이 되어있습니다."라는 메세지를 띄우고 `전체 게시글 목록 조회 페이지`로 이동시키기**(211005)**👌
    3. 게시글 조회 페이지 > 댓글 목록 조회
        - 로그인 하지 않은 사용자도 댓글 목록 조회가 가능하도록 하기 **(211004)** 👌
        - 현재 조회중인 게시글에 작성된 모든 댓글을 목록 형식으로 볼 수 있도록 하기 **(211004)** 👌
        - 댓글 목록 위에 댓글 작성란 만들기 **(211004)** 👌
            - 댓글 작성에 관한 기능은 5번 요구사항으로 연결하기
        - 댓글 목록 중, 내가 작성한 댓글인 경우 댓글 수정, 댓글 삭제 버튼 만들기 **(211005)**👌
            - 댓글 수정 버튼을 누르면 6번 요구사항으로 연결하기
            - 댓글 삭제 버튼을 누르면 7번 요구사항으로 연결하기
        - 제일 최근 작성된 댓글을 맨 위에 띄우기
    4. 게시글 조회 페이지 > 댓글 작성
        - 로그인 한 사용자만 댓글 작성이 가능하도록 하기**(211005)**👌
        - 게시글 조회 페이지 하단에 댓글 내용을 입력할 수 있는 댓글 작성 버튼 만들기 **(211005)**👌
        - 로그인 하지 않은 사용자가 댓글 작성란을 누르면 "로그인이 필요한 기능입니다." 라는 메세지를 띄우고 `로그인 페이지`로 이동시키기**(211005)**👌
        - 댓글 내용란을 비워둔 채 댓글 작성 버튼을 누르면 "댓글 내용을 입력해주세요" 라는 메세지를 띄우기
        - 댓글 내용을 입력하고 댓글 작성 버튼을 누른 경우 작성한 댓글을 추가하기
    5. 게시글 조회 페이지 > 댓글 수정
        - 내가 작성한 댓글만 수정 가능하도록 하기**(211005)**👌
        - 댓글 본문이 사라지고, 댓글 내용, 저장 버튼 생성하기 **(211004)** 👌
        - 댓글 내용에는 이전에 입력했던 댓글 내용을 기본 값으로 채우기 **(211004)** 👌
        - 수정할 댓글 내용은 비어 있지 않도록 하기 **(211005)**👌
        - 저장 버튼을 누른 경우 기존 댓글의 내용을 새로 입력한 댓글 내용으로 바꾸기**(211005)**👌
    6. 게시글 조회 페이지 > 댓글 삭제
        - 내가 작성한 댓글만 삭제 가능하도록 하기 **(211005)**👌
        - "정말로 삭제하시겠습니까?" 메세지를 띄우고, 확인/취소 버튼 중 "확인" 버튼을 누른 경우 목록에서 해당 댓글을 삭제하기 **(211004)** 👌
        - 취소를 누른 경우 삭제되지 않고 그대로 유지하기 **(211004)** 👌
    7. 회원가입 테스트 코드 작성
        - 회원가입시 구현한 아래 조건을 검사하는 테스트 코드를 작성하기
            - 닉네임은 `최소 3자 이상, 알파벳 대소문자(a~z, A~Z), 숫자(0~9)`로 이루어져 있어야 합니다.
            - 비밀번호는 `최소 4자 이상이며, 닉네임과 같은 값이 포함된 경우 회원가입에 실패`합니다.
            - 비밀번호 확인은 비밀번호와 정확하게 일치해야 합니다.
            - 데이터베이스에 존재하는 닉네임을 입력한 채 회원가입 버튼을 누른 경우 "중복된 닉네임입니다." 라는 에러메세지가 발생합니다.
        - 테스트 코드 실행 시 실제로는 데이터베이스에 연결되지 않도록 하기
        - 각 조건 별로 2개 이상의 테스트 케이스가 존재하도록 하기
- cookie-parser 라이브러리를 활용 → 로그인 권한에 따라 사용 가능한 기능들 구분

오늘도 역시, 삽질의 연속이였다. 로그인 권한이 있는지를 확인해주는 미들웨어는 req.headers에서 토큰 데이터를 받아야 작동된다. 하지만, SSR로 구현을 했기 때문에,  클라이언트 쪽에서 요청을 보낼 일이 거의 없었다. 그렇기 때문에 미들웨어를 어떻게 사용해야 좋을지 고민을 했다.

```jsx
router.get('/write', authMiddleware, (req, res) => {
	res.render('write_page');
})
```

이 API는 해당 게시판의 글을 작성하는 페이지다. 그렇기 때문에 애초에 로그인을 한 유저만 이용할 수 있도록  중간에 권한이 있는지를 파악할 수 있는 authMiddleware를 넣었다. 하지만, 그렇다면, 위에서 말했던 해당 미들웨어를 동작시키는데 필수적으로 필요한 req.headers는 어디서 받아올 수 있을까?

결국 클라이언트 쪽에서 ajax 문법으로 보내주는 방법을 생각했고 

```jsx
$.ajax({
      type: "GET",
      url: `/write`,
      data: {
      },
			headers {'token타입', "token값"}
      success: function (response) {
							....
      },
      error: function (error) {
						....
      }
  });
```

위에 headers 정보를 보내기 위해서 억지로 만들게 되었다.

그런데 위의 상태로 보내게 된다고 하더라도 res.render('write_page')는 작동하지 않는다. 왜일지를 다른 조원 분들이랑 같이 고민을 해봤다. res.render('write_page')의 값이 성공 시에 response로 가지기 때문이다.

결국 ..  cookie를 활용해서 해결하는 쪽으로 생각하고 지금 진행 중이다. 

고민했던 만큼 순조롭게 해결해 나가고 있다.

삽질은 그 순간 정말 괴롭다. 해결이 안되는 이유를 찾기위해 끈질기게 구글링한다. 

그런데 이런 삽질이 절대 불필요한 시간이라고 생각하지 않는다. 해결하는 과정에서 쌓이는 지식 역시 정말 귀중한 자산이기 때문이다.

또, 시간은 걸리더라도 어떻게든  해결할 수 있다고 나는 믿는다.